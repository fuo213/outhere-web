<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="OutHere â€” offline hiking map viewer for Utah trails, contours, and points of interest">
  <title>OutHere â€” Utah Hiking Map</title>

  <!-- Boot emoji favicon (matches booot-landing) -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¥¾</text></svg>">

  <!-- MapLibre GL JS -->
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css">
  <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>

  <!-- PMTiles protocol handler -->
  <script src="https://unpkg.com/pmtiles@3.2.1/dist/pmtiles.js"></script>

  <!-- Terra Draw â€” drawing tools for trip planning -->
  <script src="https://unpkg.com/terra-draw@1.0.0/dist/terra-draw.umd.js"></script>
  <script src="https://unpkg.com/terra-draw-maplibre-gl-adapter@1.0.0/dist/terra-draw-maplibre-gl-adapter.umd.js"></script>

  <!-- Turf.js â€” geospatial utilities for trail snapping -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>

  <!-- App styles -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- Header bar -->
  <header class="header">
    <div>
      <span class="header-title">OutHere</span>
      <span class="header-subtitle">Utah Hiking Map</span>
    </div>
    <div class="header-right">
      <button class="layers-btn" id="planBtn" aria-label="Toggle trip planning">
        Plan
      </button>
      <button class="layers-btn" id="layersBtn" aria-label="Toggle layer controls">
        Layers
      </button>
    </div>
  </header>

  <!-- Planning toolbar (hidden until Plan panel is open) -->
  <div class="planning-toolbar" id="planningToolbar">
    <button class="tool-btn" id="drawRouteBtn" title="Draw a route on the map">
      Route
    </button>
    <button class="tool-btn" id="dropCampBtn" title="Place a camp on the map">
      Camp
    </button>
    <button class="tool-btn" id="addWaypointBtn" title="Place a waypoint on the map">
      Waypoint
    </button>
  </div>

  <!-- Drawing hint overlay -->
  <div class="drawing-hint" id="drawingHint"></div>

  <!-- Map container -->
  <div id="map"></div>

  <!-- Trip planning panel (left sidebar, hidden by default) -->
  <aside class="trip-panel" id="tripPanel">
    <div class="trip-panel-section">
      <h3>Trip Plan</h3>
      <label>Name<input type="text" id="tripName" placeholder="e.g. Maze District Loop" /></label>
      <div class="trip-dates-row">
        <label>Start<input type="date" id="tripStart" /></label>
        <label>End<input type="date" id="tripEnd" /></label>
      </div>
      <label>Notes<textarea id="tripNotes" rows="2" placeholder="Permit info, logistics..."></textarea></label>
    </div>

    <div class="trip-panel-divider"></div>

    <div class="trip-panel-section">
      <h3>Features</h3>
      <div id="tripFeatureList">
        <!-- Populated by trip-panel.js -->
      </div>
    </div>

    <!-- Feature edit form (shown inline when editing) -->
    <div id="tripFeatureForm" class="trip-feature-form"></div>

    <div class="trip-panel-divider"></div>

    <div class="trip-panel-section trip-actions">
      <button class="trip-action-btn" id="downloadTripBtn">Download GeoJSON</button>
      <label class="trip-action-btn upload-label">
        Load Trip
        <input type="file" id="loadTripInput" accept=".geojson,.json" hidden />
      </label>
      <button class="trip-action-btn trip-action-danger" id="newTripBtn">New Trip</button>
    </div>

    <!-- Route drawing instructions (expands when drawing a route) -->
    <div class="route-instructions" id="routeInstructions">
      <div class="route-instructions-inner">
        <p class="route-instructions-title">Drawing Route</p>
        <ul class="route-instructions-steps">
          <li><strong>Click</strong> to place points along your route</li>
          <li>Points <strong>snap to trails</strong> when nearby</li>
          <li><strong>Double-click</strong> to finish the route</li>
          <li>Hold <strong>Shift</strong> to disable snapping</li>
          <li>Press <strong>Esc</strong> to cancel</li>
        </ul>
      </div>
    </div>
  </aside>

  <!-- Layer control panel (hidden by default) -->
  <aside class="layer-panel" id="layerPanel" role="region" aria-label="Map layers">
    <h3>Layers</h3>
    <div id="layerList">
      <!-- Populated by app.js -->
    </div>
  </aside>

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loading">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading map tiles&hellip;</p>
  </div>

  <!-- Error banner (hidden by default) -->
  <div class="error-banner" id="errorBanner"></div>

  <!-- App scripts â€” config first, then app logic, then planning -->
  <script src="config.js"></script>
  <script src="app.js"></script>
  <script src="planning.js"></script>
  <script src="trip-panel.js"></script>
</body>
</html>
